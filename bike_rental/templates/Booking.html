
{% load widget_tweaks %} {% csrf_token %}

<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Book a Bike - Bikeeez</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 0;
      background-color: #fff8f2;
      /* Updated to match homepage */
      color: #333;
      /* Homepage text color */
    }

    /* Header */
    .header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 15px 5%;
        background-color: #ff6b00;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      }

      .logo {
        font-size: 24px;
        font-weight: bold;
        color: white;
        background-color: #ff6b00;
        border: none;
      }

      .logo2 {
        font-size: 30px;
        font-weight: bold;
        color: #ff6b00;
      }

      .language-currency {
        display: flex;
        align-items: center;
        gap: 15px;
      }

      .language-currency select {
        padding: 8px 12px;
        border: 1px solid rgba(255, 255, 255, 0.3);
        border-radius: 4px;
        background-color: rgba(255, 255, 255, 0.2);
        color: white;
      }

      .loginBtn {
        padding: 8px 20px;
        background-color: white;
        color: #ff6b00;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        font-weight: bold;
        transition: all 0.3s;
      }

      .loginBtn:hover {
        background-color: #ffe0cc;
        transform: translateY(-2px);
      }

      .user-icon {
        width: 36px;
        height: 36px;
        border-radius: 50%;
        background-color: rgba(255, 255, 255, 0.3);
        display: flex;
        justify-content: center;
        align-items: center;
        cursor: pointer;
        color: white;
        transition: all 0.3s;
      }

      .user-icon:hover {
        background-color: rgba(255, 255, 255, 0.5);
      }
    /* Body */
    .container {
      display: flex;
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
    }

    .image-container {
      width: 60%;
      padding-right: 20px;
    }

    .details-container {
      width: 40%;
      padding-left: 20px;
      border-left: 1px solid #eee;
    }

    .price {
      font-size: 28px;
      font-weight: bold;
      margin-bottom: 5px;
      color: #ff6b00;
      /* Updated to match homepage */
    }

    .price-week {
      font-size: 16px;
      color: #666;
      margin-bottom: 20px;
    }

    .action-links {
      display: flex;
      margin-bottom: 30px;
    }

    .action-links a {
      color: #ff6b00;
      /* Updated to match homepage */
      text-decoration: none;
      font-size: 14px;
    }

    .section {
      margin-bottom: 25px;
    }

    .section-title {
      font-weight: bold;
      margin-bottom: 10px;
      font-size: 15px;
      color: #ff6b00;
      /* Updated to match homepage */
    }

    .date-range-input {
      width: 100%;
      padding: 10px;
      border: 1px solid #ff9e4d;
      /* Homepage input border color */
      border-radius: 4px;
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
      font-size: 14px;
      color: #666;
      background-color: #fff3e0;
      /* Homepage input background */
      transition: all 0.3s;
      /* Homepage transition */
    }

    .date-range-input:focus {
      border-color: #ff6b00;
      outline: none;
      box-shadow: 0 0 5px rgba(255, 107, 0, 0.3);
    }

    .bike-size-row {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .bike-size-input {
      flex: 1;
      padding: 10px;
      border: 1px solid #ff9e4d;
      /* Homepage input border color */
      border-radius: 4px;
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
      font-size: 14px;
      color: #666;
      background-color: #fff3e0;
      /* Homepage input background */
    }

    .quantity-input {
      width: 60px;
      padding: 10px;
      border: 1px solid #ff9e4d;
      /* Homepage input border color */
      border-radius: 4px;
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
      background-color: #fff3e0;
      /* Homepage input background */
    }

    hr {
      border: none;
      border-top: 1px solid #eee;
      margin: 25px 0;
    }

    #check-availability {
      background-color: #ff9800;
      /* Preserved as per original */
      color: white;
      padding: 12px 0;
      border: none;
      border-radius: 16px;
      cursor: pointer;
      margin-bottom: 20px;
      width: 100%;
      font-size: 16px;
      font-weight: bold;
      transition: background-color 0.2s;
    }

    #check-availability:hover {
      background-color: #f57c00;
      /* Preserved as per original */
    }

    .discount-box {
      background-color: #fff3e0;
      /* Updated to match homepage input background */
      padding: 15px;
      border-radius: 6px;
      font-size: 14px;
      margin-bottom: 25px;
    }

    .discount-title {
      font-weight: bold;
      margin-bottom: 5px;
      color: #ff6b00;
      /* Updated to match homepage */
    }

    .bike-title {
      font-size: 23px;
      font-weight: bold;
      margin-top: 10px;
      margin-bottom: 5px;
      color: #ff6b00;
      /* Updated to match homepage */
    }

    .location {
      display: flex;
      align-items: center;
      font-size: 14px;
      color: #666;
      margin-bottom: 15px;
    }

    .bike-info {
      display: flex;
      align-items: center;
      gap: 5px;
      margin-top: 25px;
    }

    .rating {
      color: #ff6b00;
      /* Updated to match homepage */
      font-weight: bold;
    }

    .user-rating {
      display: flex;
      align-items: center;
    }

    .star-rating {
      display: flex;
      flex-direction: row-reverse;
      justify-content: flex-end;
      font-size: 24px;
    }

    .star-rating input {
      display: none;
    }

    .star-rating label {
      color: #d1d5db;
      cursor: pointer;
      transition: color 0.3s ease, transform 0.2s ease;
      margin: 0 1px;
    }

    .star-rating label:hover,
    .star-rating label:hover~label,
    .star-rating input:checked~label {
      color: #f59e0b;
      transform: scale(1.2);
    }

    .star-rating input:checked~label {
      color: #f59e0b;
    }

    @media (max-width: 400px) {
      .user-info {
        flex-direction: column;
        align-items: flex-start;
        padding: 15px;
      }

      .user-avatar {
        margin: 0 0 15px 0;
      }
    }

    .bike-model {
      font-weight: lighter;
      font-size: 14px;
      color: #666;
    }

    .bike-description {
      font-size: 14px;
      color: #666;
      margin-bottom: 20px;
      line-height: 1.5;
    }

    .look-link {
      color: #ff6b00;
      /* Updated to match homepage */
      text-decoration: none;
      font-size: 14px;
      display: inline-block;
      margin-bottom: 20px;
    }

    .user-info {
      display: flex;
      align-items: center;
      margin-top: 30px;
    }

    .user-avatar {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background-color: #ddd;
      margin-right: 10px;
      margin-bottom: 30px;
    }

    .user-details {
      flex-grow: 1;
    }

    .user-name {
      font-weight: bold;
      font-size: 14px;
      color: #333;
    }

    .user-response {
      font-size: 12px;
      color: #666;
    }

    .user-reviews {
      font-size: 12px;
      color: #666;
    }

    .profile-btn {
      background-color: #ff9800;
      /* Preserved as per original */
      color: white;
      padding: 12px 0;
      border: none;
      border-radius: 16px;
      cursor: pointer;
      width: 160px;
      font-size: 16px;
      font-weight: bold;
      transition: background-color 0.2s;
      margin-right: 280px;
      margin-left: 50px;
    }

    /* Map Section */
    .map-section {
      padding: 40px 5%;
      background-color: #fff3e8;
      /* Updated to match homepage alternating section */
    }

    .map-section h3 {
      font-size: 24px;
      font-weight: bold;
      margin-bottom: 20px;
      margin-left: 140px;
      color: #ff6b00;
      /* Updated to match homepage */
    }

    .map-container {
      display: flex;
      justify-content: center;
      align-items: center;
      width: 100%;
    }

    .map-container span {
      border-radius: 10%;
      overflow: hidden;
      width: 90%;
    }

    .map-container iframe {
      border: 0;
      height: 320px;
      width: 100%;
    }

    /* Frequently Booked Section */
    .frequently-booked {
      background-color: #fff8f2;
      /* Updated to match homepage body */
      margin-bottom: 40px;
      padding: 40px 5%;
    }

    .frequently-booked h2 {
      font-size: 28px;
      padding: 0;
      color: #ff6b00;
      /* Updated to match homepage */
      margin-bottom: 20px;
    }

    .card-container {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
      gap: 25px;
      margin-top: 20px;
    }

    .card {
      border-radius: 10px;
      overflow: hidden;
      box-shadow: 0 4px 15px rgba(255, 107, 0, 0.1);
      background: white;
      transition: all 0.3s;
      border: 1px solid #ffe0cc;
    }

    .card:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 20px rgba(255, 107, 0, 0.2);
      border-color: #ff6b00;
    }

    .card img {
      width: 100%;
      height: 180px;
      object-fit: cover;
      transition: transform 0.5s;
    }

    .card:hover img {
      transform: scale(1.05);
    }

    .card-content {
      padding: 15px;
    }

    .card h3 {
      font-size: 18px;
      margin-bottom: 8px;
      color: #333;
    }

    .card p {
      margin-bottom: 8px;
      font-size: 14px;
      color: #666;
    }

    .price {
      color: #ff6b00;
      font-weight: bold;
      font-size: 16px;
    }

    .rating {
      color: #ff9e00;
      display: flex;
      align-items: center;
      gap: 5px;
    }

    .location {
      font-size: 12px;
      color: #888;
    }

    @media (max-width: 1024px) {
      .card-container {
        grid-template-columns: repeat(2, 1fr);
      }
    }

    @media (max-width: 768px) {
      .card-container {
        grid-template-columns: repeat(1, 1fr);
      }

      .container {
        flex-direction: column;
      }

      .image-container,
      .details-container {
        width: 100%;
        padding: 0;
      }

      .details-container {
        border-left: none;
        border-top: 1px solid #eee;
        padding-top: 20px;
      }

      .profile-btn {
        margin-right: 0;
        width: 50%;
      }

      .action-links a.wishlist {
        margin-left: auto;
      }

      .map-section h3 {
        margin-left: 0;
      }
    }

    .popup-overlay {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5);
      justify-content: center;
      align-items: center;
      z-index: 1000;
    }

    .popup {
      background: white;
      border-radius: 12px;
      padding: 20px;
      width: 90%;
      max-width: 400px;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
      position: relative;
    }

    .popup-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }

    .popup-header h3 {
      font-size: 18px;
      font-weight: bold;
      color: #333;
      margin: 0;
    }

    .popup-close {
      background: none;
      border: none;
      font-size: 24px;
      color: #ff6b00;
      cursor: pointer;
    }

    .popup-content {
      font-size: 14px;
      color: #333;
    }

    .popup-content .duration {
      background: #f5f5f5;
      padding: 10px;
      border-radius: 8px;
      text-align: center;
      margin-bottom: 20px;
      font-weight: bold;
    }

    .popup-content .cost-row {
      display: flex;
      justify-content: space-between;
      margin-bottom: 10px;
    }

    .cost-row .label {
      font-weight: bold;
    }

    .cost-row .value {
      color: #666;
    }

    .cost-row .info-icon {
      color: #ff6b00;
      margin-left: 5px;
      font-size: 12px;
      cursor: pointer;
    }

    .popup-content .total {
      display: flex;
      justify-content: space-between;
      font-size: 16px;
      font-weight: bold;
      margin-top: 15px;
      padding-top: 15px;
      border-top: 1px solid #eee;
    }

    .popup-content .vat {
      font-size: 12px;
      color: #999;
      text-align: right;
      margin-top: 5px;
    }

    .rent-now-btn {
      background-color: #ff6b00;
      color: white;
      padding: 12px;
      border: none;
      border-radius: 12px;
      cursor: pointer;
      width: 100%;
      font-size: 16px;
      font-weight: bold;
      margin-top: 20px;
      transition: background-color 0.2s;
    }

    .rent-now-btn:hover {
      background-color: #f57c00;
    }

    /* About Us */
    .about {
      background: #fff3e8;
      /* Updated to match homepage alternating section */
      padding: 40px 20px;
      text-align: center;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
    }

    .about-content {
      max-width: 800px;
      text-align: center;
    }

    .about h2 {
      font-size: 28px;
      color: #ff6b00;
      /* Updated to match homepage */
      margin-bottom: 15px;
    }

    .about h3 {
      font-size: 18px;
      color: #ff6b00;
      /* Updated to match homepage */
      margin-bottom: 10px;
    }

    .about p {
      text-align: justify;
      margin-bottom: 10px;
      color: #333;
    }

    .about ul {
      text-align: left;
      display: inline-block;
      margin-top: 10px;
      color: #333;
    }

    /* Footer Styles */
    .footer {
      background-color: #fbebd9;
      padding: 40px 20px;
      width: 1800px;
      margin-top: 50px;
      /* margin-left: -250px; */
      margin-bottom: -50px;
      margin-right: -250px;
      border-top: 1px solid #ffe0b2;
    }

    .footer-container {
      display: flex;
      flex-wrap: wrap;
      max-width: 1500px;
      margin: 0 auto;
      gap: 40px;
      justify-content: space-between;
    }

    /* Logo Section */
    .footer-logo {
      flex: 0 0 200px;
    }

    .footer-logo .logo {
      font-size: 1.8rem;
      margin-bottom: 15px;
      display: flex;
      align-items: center;
      color: #ffffff;
    }

    .footer-logo p {
      line-height: 1.6;
      color: #666;
    }

    /* Links Sections */
    .footer-links {
      min-width: 150px;
    }

    .footer-links h3 {
      color: #ff6b00;
      margin-top: 0;
      margin-bottom: 20px;
      font-size: 1.1rem;
    }

    .footer-links ul {
      list-style: none;
      padding: 0;
      margin: 0;
    }

    .footer-links li {
      margin-bottom: 8px;
    }

    .footer-links a {
      color: #666;
      text-decoration: none;
      transition: color 0.3s;
    }

    .footer-links a:hover {
      color: #ff6b00;
    }

    /* Copyright Section */
    .footer-bottom {
      text-align: center;
      margin-top: 40px;
      padding-top: 20px;
      border-top: 1px solid #ffe0b2;
      color: #999;
    }

    /* Responsive adjustments */
    @media (max-width: 768px) {
      .footer-container {
        flex-direction: column;
        gap: 30px;
      }

      .footer-logo {
        flex: 1;
        text-align: center;
      }

      .footer-links {
        text-align: center;
      }
    }
  </style>
</head>

<body>
    <!-- Header -->
    {{ bikes|json_script:"bikes-data" }}
    <header class="header">
      <div class="logo">üö¥‚Äç‚ôÇÔ∏è <b>Bikeeez</b></div>
      <div class="language-currency">
        <!-- <select>
          <option value="en">EN</option>
          <option value="np">NP</option>
        </select> -->
        <div class="language-currency">
          <button type="button" class="loginBtn" data-url="{% url 'logout' %}" onclick="redirectToLogout()">
              Logout
          </button>
  
          <script>
              function redirectToLogout() {
                  var logoutUrl = document.querySelector('.loginBtn').getAttribute('data-url');
                  setTimeout(() => { window.location.href = logoutUrl; }, 500);
              }
          </script>
      </div>
  
        <a href="{% url 'profile' %}">
          <div class="user-icon">üë§</div>
      </a>
      </div>
    </header>

   
  <div class="container">
    <div class="image-container">
      <!-- Bike image dynamically populated from the database -->
{% load static %}
<style>
  .carousel {
    width: 100%;
    height: 400px;
    border-radius: 8px;
    background-color: #dddada;
    overflow: hidden;
    position: relative;
  }

  .carousel-track {
    display: flex;
    height: 100%;
    transition: transform 0.3s ease-in-out;
  }

  .carousel-item {
    flex: 0 0 100%;
    height: 100%;
  }

  .carousel-item img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    border-radius: 8px;
  }

  .carousel-nav {
    position: absolute;
    top: 50%;
    width: 100%;
    display: flex;
    justify-content: space-between;
    transform: translateY(-50%);
  }

  .carousel-btn {
    background-color: rgba(255, 107, 0, 0.8);
    color: white;
    border: none;
    border-radius: 50%;
    width: 40px;
    height: 40px;
    font-size: 18px;
    cursor: pointer;
    margin: 0 10px;
  }

  .carousel-btn:hover {
    background-color: #f57c00;
  }

  @media (hover: none) {
    .carousel-btn { display: none; }
  }

  @media (max-width: 768px) {
    .carousel { height: 300px; }
  }
</style>

<div class="carousel">
  <div class="carousel-track" id="carousel-track">
    {% for image in bike.images %}
      <div class="carousel-item">
        <img src="{{ image.url }}" alt="{{ bike.name }}" />
      </div>
    {% empty %}
      <div class="carousel-item">
        <img src="{{ bike.image.url|default:'/static/bike2.jpeg' }}" alt="{{ bike.name }}" />
      </div>
      <div class="carousel-item">
        <img src="{% static 'bike3.jpeg' %}" alt="{{ bike.name }}" />
      </div>
      <div class="carousel-item">
        <img src="{% static 'bike4.jpeg' %}" alt="{{ bike.name }}" />
      </div>
    {% endfor %}
  </div>
  <div class="carousel-nav">
    <button class="carousel-btn prev" id="prev-btn">‚Äπ</button>
    <button class="carousel-btn next" id="next-btn">‚Ä∫</button>
  </div>
</div>

<script>
  const track = document.getElementById("carousel-track");
  const prevBtn = document.getElementById("prev-btn");
  const nextBtn = document.getElementById("next-btn");
  const items = track.querySelectorAll(".carousel-item");
  let index = 0;

  function updateCarousel() {
    track.style.transform = `translateX(${-index * 100}%)`;
  }

  nextBtn.addEventListener("click", () => {
    if (index < items.length - 1) {
      index++;
      updateCarousel();
    }
  });

  prevBtn.addEventListener("click", () => {
    if (index > 0) {
      index--;
      updateCarousel();
    }
  });

  let startX = 0;
  track.addEventListener("touchstart", (e) => {
    startX = e.changedTouches[0].screenX;
  });

  track.addEventListener("touchend", (e) => {
    const endX = e.changedTouches[0].screenX;
    if (startX - endX > 50 && index < items.length - 1) {
      index++;
    } else if (endX - startX > 50 && index > 0) {
      index--;
    }
    updateCarousel();
  });
</script>
```

      <div class="bike-info">
        <div class="bike-title">{{ bike.name }}</div>
        <!-- Dynamically display bike name -->
        <div class="bike-model">| {{ bike.model_name }}</div>
        <!-- Dynamically display bike model -->
      </div>

      <div class="location">
        <span>{{ bike.location }}</span>
        <!-- Dynamically display bike location -->
        <span style="margin: 0 5px">‚Ä¢</span>
        <span class="rating">{{ bike.rating }} ({{ bike.reviews_count }})</span>
        <!-- Dynamically display rating and reviews count -->
      </div>

      <div class="bike-description">
        {{ bike.description }}
        <!-- Dynamically display bike description -->
      </div>

      <div class="user-info">
        <div class="user-avatar">
          <img src="{{ bike.user.avatar.url }}" alt="{{ bike.user.name }}" class="avatar" />
          <!-- Dynamically display user's avatar -->
        </div>
        <div class="user-details">
          <div class="user-name" style="font-size: 20px">
            {{ bike.user.name }}
          </div>
          <!-- Dynamically display user's name -->
          <!-- <div class="user-response">Response time ~{{ bike.user.response_time }}h</div> -->
          <!-- Dynamically display user's response time -->
          <!-- <div class="user-reviews">{{ bike.user.reviews_count }} Reviews</div> -->
          <!-- Dynamically display number of reviews -->
        </div>
        <div class="user-rating">
          <form class="star-rating" method="POST" action="{% url 'rate_bike' bike.id %}">
            {% csrf_token %}
        
            <!-- Comment Field -->
            <div>
              {{ form.comment.label_tag }}<br>
              {{ form.comment }}
            </div>
        
            <!-- Star Rating Inputs -->
            <div class="star-rating">
              <input type="hidden" name="rating" value="null" id="rating_null">
              
              <input type="radio" id="star5" name="rating" value="5" {% if form.rating.value == 5 %}checked{% endif %}>
              <label for="star5" title="5 stars">‚òÖ</label>
        
              <input type="radio" id="star4" name="rating" value="4" {% if form.rating.value == 4 %}checked{% endif %}>
              <label for="star4" title="4 stars">‚òÖ</label>
        
              <input type="radio" id="star3" name="rating" value="3" {% if form.rating.value == 3 %}checked{% endif %}>
              <label for="star3" title="3 stars">‚òÖ</label>
        
              <input type="radio" id="star2" name="rating" value="2" {% if form.rating.value == 2 %}checked{% endif %}>
              <label for="star2" title="2 stars">‚òÖ</label>
        
              <input type="radio" id="star1" name="rating" value="1" {% if form.rating.value == 1 %}checked{% endif %}>
              <label for="star1" title="1 star">‚òÖ</label>
            </div>
        
            <button class="profile-btn" type="submit">Submit</button>
          </form>
        </div>
        <!-- <button class="profile-btn">Profile</button> -->
      </div>
    </div>

    <div class="details-container">
      <form id="rental-form" method="POST" action="{% url 'Booking' bike_id=bike.id %}">
        {% csrf_token %}

        <div class="price" style="font-size: 30px">
          Rs.{{ bike.daily_rate }} / day
        </div>
        <!-- Dynamically display daily price -->
        <div class="price-week">Rs.{{ bike.weekly_rate }}/ week</div>
        <!-- Dynamically display weekly price -->

        <div class="action-links">
          <a href="#" class="share">Share</a>
          <!-- <a href="#" class="wishlist" style="margin-left: 300px; font-weight: bolder">Add to wishlist</a> -->
        </div>

        <div class="section">
          <div class="section-title">Select Date Range</div>
          {% load widget_tweaks %}

          <label>Start Date:</label>
          {{ form.start_date|add_class:"date-range-input"|attr:"id:start-date" }}

          <label>End Date:</label>
          {{ form.end_date|add_class:"date-range-input"|attr:"id:end-date" }}
        </div>

        <script>
          document
            .getElementById("start-date")
            .addEventListener("change", function () {
              document.getElementById("end-date").min = this.value;
            });
        </script>

        <div class="section">
          <div class="section-title">Quantity</div>
          <input type="number" name="quantity" id="quantity" value="1" min="1" class="quantity-input" />
        </div>

        <hr />

      </form>
      <button id="check-availability">
        Check availability
      </button>

      <div class="discount-box">
        <div class="discount-title"> Discount</div>
        <div>
          By using our website for bike booking you would get discount upto 20%.
        </div>
      </div>
    </div>
  </div>

  <!-- Popup page -->
  <div class="popup-overlay" id="popup-overlay">
    <div class="popup">
      <div class="popup-header">
        <h3>Firefox Meteor 700C</h3>
        <button class="popup-close" id="popup-close">‚úï</button>
      </div>
      <div class="popup-content">
        <div class="duration" id="duration-text"></div>
        <div class="cost-row">
          <span class="label">Subtotal <span class="info-icon">‚ìò</span></span>
          <span class="value" id="subtotal">Rs 100.00 </span>
        </div>
        <div class="cost-row">
          <span class="label">Quantity <span class="info-icon">‚ìò</span></span>
          <span class="value" id="service-fee">1 </span>
        </div>
        <div class="cost-row">
          <span class="label">Discount <span class="info-icon">‚ìò</span></span>
          <span class="value" id="insurance">Rs 12 </span>
        </div>
        <div class="total">
          <span>Total amount</span>
          <span id="total-amount">Rs 0,00</span>
        </div>
      </div>
      <button class="rent-now-btn" id="rent-now-btn">Rent now</button>
    </div>
  </div>

  <!-- Map Section -->
  <section class="map-section">
    <h3>Current bike location</h3>
    <div class="map-container">
      <span>
<div class="map-container">
  <iframe
    width="100%"
    height="320"
    style="border:0"
    loading="lazy"
    allowfullscreen
    referrerpolicy="no-referrer-when-downgrade"
    src="https://www.google.com/maps?q={{ bike.latitude }},{{ bike.longitude }}&output=embed">
  </iframe>
</div>
      </span>
    </div>
  </section>

  <!-- Frequently Booked Section -->
  <section class="bikes-section" style="margin-left: 120px;">
    <h2>Recently Booked</h2>
    <div class="card-container">
      <!-- Card 1 -->
      <div class="card">
        {% if random_bikes|length > 0 %}
        <a href="{% url 'Booking' random_bikes.0.id %}" style="text-decoration: none; color: inherit;">
          <img src="{{ random_bikes.0.image.url }}" alt="{{ random_bikes.0.name }}" />
          <div class="card-content">
            <h3>{{ random_bikes.0.name }}</h3>
            <p>{{ random_bikes.0.short_description | default:"No description available." }}</p>
            <p class="price">
              Rs. {{ random_bikes.0.daily_rate }} /day | Rs. {{ random_bikes.0.weekly_rate }} /week
            </p>
            <p class="rating">
              ‚≠ê {{ random_bikes.0.rating | default:"N/A" }} ({{ random_bikes.0.reviews_count }} reviews)
            </p>
            <p class="location">
              {{ random_bikes.0.location | default:"Location not available" }}
            </p>
          </div>
        </a>
        {% else %}
        <p>No bike data available.</p>
        {% endif %}
      </div>


      <!-- Card 2 -->
      <div class="card">
        <!-- Check if there are bikes and use the first one (random_bike.0) -->
        {% if random_bikes|length > 1 %}
        <a href="{% url 'Booking' random_bikes.1.id %}" style="text-decoration: none; color: inherit;">
          <img src="{{ random_bikes.1.image.url }}" alt="{{ random_bikes.1.name }}" />

          <div class="card-content">
            <h3>{{ random_bikes.1.name }}</h3>

            <!-- Bike description, with a default message if not available -->
            <p>{{ random_bikes.1.short_description | default:"No description available." }}</p>

            <p class="price">
              Rs. {{ random_bikes.1.daily_rate }} /day | Rs. {{ random_bikes.1.weekly_rate }} /week
            </p>

            <!-- Rating -->
            <p class="rating">
              ‚≠ê {{ random_bikes.1.rating | default:"N/A" }} ({{ random_bikes.1.reviews_count }} reviews)
            </p>

            <p class="location">
              {{ random_bikes.1.location | default:"Location not available" }}
            </p>
          </div>
        </a>
        {% else %}
        <p>No bike data available.</p>
        {% endif %}
      </div>

      <!-- Card 3 -->
      <div class="card">
        <!-- Check if there are bikes and use the first one (random_bike.0) -->
        {% if random_bikes|length > 2 %}
        <a href="{% url 'Booking' random_bikes.2.id %}" style="text-decoration: none; color: inherit;">
          <img src="{{ random_bikes.2.image.url }}" alt="{{ random_bikes.2.name }}" />

          <div class="card-content">
            <h3>{{ random_bikes.2.name }}</h3>

            <!-- Bike description, with a default message if not available -->
            <p>{{ random_bikes.2.short_description | default:"No description available." }}</p>

            <p class="price">
              Rs. {{ random_bikes.2.daily_rate }} /day | Rs. {{ random_bikes.2.weekly_rate }} /week
            </p>

            <!-- Rating -->
            <p class="rating">
              ‚≠ê {{ random_bikes.2.rating | default:"N/A" }} ({{ random_bikes.2.reviews_count }} reviews)
            </p>

            <p class="location">
              {{ random_bikes.2.location | default:"Location not available" }}
            </p>
          </div>
        </a>
        {% else %}
        <p>No bike data available.</p>
        {% endif %}
      </div>

      <!-- Card 4 -->
      <div class="card">
        <!-- Check if there are bikes and use the first one (random_bike.0) -->
        {% if random_bikes|length > 3 %}
        <a href="{% url 'Booking' random_bikes.3.id %}" style="text-decoration: none; color: inherit;">
          <img src="{{ random_bikes.3.image.url }}" alt="{{ random_bikes.3.name }}" />

          <div class="card-content">
            <h3>{{ random_bikes.3.name }}</h3>

            <!-- Bike description, with a default message if not available -->
            <p>{{ random_bikes.3.short_description | default:"No description available." }}</p>

            <p class="price">
              Rs. {{ random_bikes.3.daily_rate }} /day | Rs. {{ random_bikes.3.weekly_rate }} /week
            </p>

            <!-- Rating -->
            <p class="rating">
              ‚≠ê {{ random_bikes.3.rating | default:"N/A" }} ({{ random_bikes.3.reviews_count }} reviews)
            </p>

            <p class="location">
              {{ random_bikes.3.location | default:"Location not available" }}
            </p>
          </div>
        </a>
        {% else %}
        <p>No bike data available.</p>
        {% endif %}
      </div>

      <!-- Card 5 -->
      <div class="card">
        <!-- Check if there are bikes and use the first one (random_bike.0) -->
        {% if random_bikes|length > 4 %}
        <a href="{% url 'Booking' random_bikes.4.id %}" style="text-decoration: none; color: inherit;">
          <img src="{{ random_bikes.4.image.url }}" alt="{{ random_bikes.1.name }}" />

          <div class="card-content">
            <h3>{{ random_bikes.4.name }}</h3>
            <!-- Bike description, with a default message if not available -->
            <p>{{ random_bikes.4.short_description | default:"No description available." }}</p>

            <p class="price">
              Rs. {{ random_bikes.4.daily_rate }} /day | Rs. {{ random_bikes.4.weekly_rate }} /week
            </p>

            <!-- Rating -->
            <p class="rating">
              ‚≠ê {{ random_bikes.4.rating | default:"N/A" }} ({{ random_bikes.4.reviews_count }} reviews)
            </p>

            <p class="location">
              {{ random_bikes.4.location | default:"Location not available" }}
            </p>
          </div>
        </a>
        {% else %}
        <p>No bike data available.</p>
        {% endif %}
      </div>
    </div>
  </section>

  <!-- Footer -->
  <footer class="footer" style="width: 100%">
    <div class="footer-container">
      <!-- Logo Section -->
      <div class="footer-logo">
        <div class="logo">üö¥‚Äç‚ôÇÔ∏è <b>Bikeeez</b></div>
        <p>Kathmandu's premier bike rental platform</p>
      </div>

      <!-- Quick Links Section -->
      <div class="footer-links">
        <h3>Quick Links</h3>
        <ul>
          <li><a href="home.html">Home</a></li>
          <li><a href="aboutus.html">About Us</a></li>
          <li><a href="contactus.html">Contact Us</a></li>
          <!-- <li><a href="/admin/adminlogin.html">Admin</a></li> -->
          <li><a href="/privacy">Privacy</a></li>
        </ul>
      </div>

      <!-- Top Places Section -->
      <div class="footer-links">
        <h3>Top Places</h3>
        <ul>
          <li><a href="#">Thamel</a></li>
          <li><a href="#">Jhamsikhel</a></li>
          <li><a href="#">Boudha</a></li>
          <li><a href="#">Patan</a></li>
          <li><a href="#">Bhaktapur</a></li>
        </ul>
      </div>
    </div>

    <!-- Copyright Section -->
    <div class="footer-bottom">
      <p>¬© 2025 Bikeeez Nepal. All rights reserved.</p>
    </div>
  </footer>

<script>
// Popup logic
const popupOverlay = document.getElementById("popup-overlay");
const popupClose = document.getElementById("popup-close");
const rentNowBtn = document.getElementById("rent-now-btn");
const checkAvailabilityBtn = document.getElementById("check-availability");
const rentalForm = document.getElementById("rental-form");

const startDateInput = document.getElementById("start-date");
const endDateInput = document.getElementById("end-date");
const quantityInput = document.getElementById("quantity");

// Set minimum date for calendar inputs
const today = new Date();
const tomorrow = new Date(today);
tomorrow.setDate(today.getDate() + 1);

// Format date for min attribute (YYYY-MM-DD)
const formatDate = (date) => {
  return date.toISOString().split("T")[0];
};

startDateInput.setAttribute("min", formatDate(today));
endDateInput.setAttribute("min", formatDate(tomorrow));

// Update end date min when start date changes
startDateInput.addEventListener("change", () => {
  const startDate = new Date(startDateInput.value);
  const minEndDate = new Date(startDate);
  minEndDate.setDate(startDate.getDate() + 1);
  endDateInput.setAttribute("min", formatDate(minEndDate));
  if (endDateInput.value && new Date(endDateInput.value) <= startDate) {
    endDateInput.value = "";
  }
});

checkAvailabilityBtn.addEventListener("click", function () {
  const startDateInputValue = startDateInput.value;
  const endDateInputValue = endDateInput.value;
  const quantity = parseInt(quantityInput.value) || 1; // Use value from form quantity input

  // Validate inputs
  if (!startDateInputValue || !endDateInputValue) {
    alert("Please select both start and end dates.");
    return;
  }

  const startDate = new Date(startDateInputValue);
  const endDate = new Date(endDateInputValue);
  const timeDiff = endDate - startDate;
  const days = Math.ceil(timeDiff / (1000 * 60 * 60 * 24));

  if (days <= 0) {
    alert("End date must be after start date.");
    return;
  }

  // Reset popup values before calculation
  document.getElementById("duration-text").textContent = "";
  document.getElementById("subtotal").textContent = "Rs 0.00";
  document.getElementById("service-fee").textContent = "0";
  document.getElementById("insurance").textContent = "Rs 0.00";
  document.getElementById("total-amount").textContent = "Rs 0.00";

  // Calculate costs
  const pricePerDay = parseFloat(document.getElementById("subtotal").textContent.replace("Rs ", "").replace(",", "")) || 60.00; // Fallback to 60.00 if initial value is reset
  const subtotal = pricePerDay * days * quantity;
  const discount = (subtotal * 0.20).toFixed(2); // 20% of subtotal
  const total = (subtotal - parseFloat(discount)).toFixed(2);

  // Format dates for display
  const options = {
    day: "numeric",
    month: "short",
    year: "numeric",
  };
  const startFormatted = startDate.toLocaleString("en-US", options);
  const endFormatted = endDate.toLocaleString("en-US", options);

  // Update popup content with new calculations
  document.getElementById("duration-text").textContent = `${startFormatted} - ${endFormatted}`;
  document.getElementById("subtotal").textContent = `Rs ${subtotal.toFixed(2)}`;
  document.getElementById("service-fee").textContent = `${quantity}`; // Display quantity from form
  document.getElementById("insurance").textContent = `Rs ${discount}`; // Display 20% discount
  document.getElementById("total-amount").textContent = `Rs ${total}`;

  // Show popup
  popupOverlay.style.display = "flex";
});

popupClose.addEventListener("click", function () {
  popupOverlay.style.display = "none";
});

rentNowBtn.addEventListener("click", function () {
  rentalForm.submit();
  popupOverlay.style.display = "none";
  alert("Bike rental confirmed! Redirecting to payment...");
});

popupOverlay.addEventListener("click", function (e) {
  if (e.target === popupOverlay) {
    popupOverlay.style.display = "none";
  }
});
  </script>
</body>

</html>
